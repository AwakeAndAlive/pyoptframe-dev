<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quick start (Continued) &mdash; optframe 4.3 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Concepts" href="concepts.html" />
    <link rel="prev" title="Quick start" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/optframe-cut.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick start (Continued)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#second-example-traveling-salesman-problem-local-search-and-random-keys-genetic-algorithm">Second example: Traveling Salesman Problem, Local Search and Random Keys Genetic Algorithm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tsp-solution-definition">TSP Solution definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#problem-data">Problem Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#evaluation">Evaluation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#search-methods-based-on-neighborhoods">Search methods based on neighborhoods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#random-constructive">Random constructive</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-move-operator-swap">First move operator: Swap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-example-for-tsp-components">Complete Example for TSP Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exploring-with-neighborhood-exploration">Exploring with neighborhood exploration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-example-for-ils">Complete Example for ILS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#search-methods-based-on-random-keys">Search methods based on random keys</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#random-key-generation">Random key generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#brkga-decoding">BRKGA decoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#brkga-with-tsp">BRKGA with TSP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-example-for-brkga">Complete Example for BRKGA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#more-examples">More Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="fcore.html">FCore Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_checkmodule.html">Advanced - CheckModule</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">optframe</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Quick start (Continued)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/quickstart_continued.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="quick-start-continued">
<h1>Quick start (Continued)<a class="headerlink" href="#quick-start-continued" title="Permalink to this headline"></a></h1>
<p>We expand the knowledge from <a class="reference external" href="../quickstart">Quick Start</a> where the user
has learned how to <a class="reference external" href="../install">Install</a> OptFrame, and how to compile and
test a <a class="reference external" href="https://en.wikipedia.org/wiki/Simulated_annealing">Simulated Annealing</a> metaheuristic
for the classic 0-1 Knapsack Problem (01KP).</p>
<p>We demonstrate how to update this code for other metaheuristics, for the classic Traveling Salesman Problem (TSP).</p>
<section id="second-example-traveling-salesman-problem-local-search-and-random-keys-genetic-algorithm">
<h2>Second example: Traveling Salesman Problem, Local Search and Random Keys Genetic Algorithm<a class="headerlink" href="#second-example-traveling-salesman-problem-local-search-and-random-keys-genetic-algorithm" title="Permalink to this headline"></a></h2>
<p>At this point, we assume the reader is familiarized with the Traveling Salesman Problem…
we intend to expand this section in the future with figures and more motivation (for now, sorry, and let’s move on).</p>
<section id="tsp-solution-definition">
<h3>TSP Solution definition<a class="headerlink" href="#tsp-solution-definition" title="Permalink to this headline"></a></h3>
<p>We define a TSP solution as a permutations of $N$ cities being visited by a Traveling Salesman.
In this representation, each city is represented as a number $0..N-1$, being a solution a
vector of N integers (example: [0,2,3,1] means that solution starts from city 0, then follows to city 2,
then city 3, then city 1, and finally comes back to city 0).
Objective is to find a route that minimizes distance between the $N$ visited cities.</p>
<p>We may define ESolutionTSP as a pair, containing a solution and its objective value (double).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#pragma once</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="linenos"> 4</span><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"></span>
<span class="linenos"> 5</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="cp">#include</span> <span class="cpf">&lt;OptFCore/FCore.hpp&gt;</span><span class="cp"></span>
<span class="linenos"> 8</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Core.hpp&gt;</span><span class="cp"></span>
<span class="linenos"> 9</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Heuristics/Heuristics.hpp&gt;</span><span class="c1"> // many metaheuristics here...</span><span class="cp"></span>
<span class="linenos">10</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Scanner++/Scanner.hpp&gt;</span><span class="cp"></span>
<span class="linenos">11</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Util/Matrix.hpp&gt;</span><span class="cp"></span>
<span class="linenos">12</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/printable/printable.hpp&gt;</span><span class="cp"></span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="linenos">15</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">optframe</span><span class="p">;</span>
<span class="linenos">16</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">scannerpp</span><span class="p">;</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="c1">// define TSP solution type as &#39;vector&lt;int&gt;&#39;, using &#39;double&#39; as evaluation type</span>
<span class="linenos">19</span><span class="k">using</span> <span class="n">ESolutionTSP1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span>
<span class="linenos">20</span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="c1">// first part of search space element: solution (representation)</span>
<span class="linenos">21</span>  <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>   <span class="c1">// second part of search space element: evaluation (objective value)</span>
<span class="linenos">22</span>  <span class="o">&gt;</span><span class="p">;</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">X</span> <span class="o">=</span> <span class="n">nullptr_t</span><span class="o">&gt;</span>
<span class="linenos">25</span><span class="k">using</span> <span class="n">ESolutionTSP2</span> <span class="o">=</span> <span class="n">ESolutionTSP1</span><span class="p">;</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="k">using</span> <span class="n">ESolutionTSP</span> <span class="o">=</span> <span class="n">ESolutionTSP2</span><span class="o">&lt;&gt;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="problem-data">
<h3>Problem Data<a class="headerlink" href="#problem-data" title="Permalink to this headline"></a></h3>
<p>We read a matrix of distances between pairs of cities (considering Euclidean distance), and
store in a structure named ProblemContext. Note that we round the result to int, just to allow
precise value calculation (but one may use float or double, and then manage the floating-point errors).
Do not forget to #include helpers from optframe namespace,
such as Matrix and Scanner.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">// TSP problem context and data reads</span>
<span class="linenos"> 2</span><span class="k">class</span> <span class="nc">ProblemContext</span>
<span class="linenos"> 3</span><span class="p">{</span>
<span class="linenos"> 4</span><span class="k">public</span><span class="o">:</span>
<span class="linenos"> 5</span>   <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>            <span class="c1">// number of clients</span>
<span class="linenos"> 6</span>   <span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dist</span><span class="p">;</span> <span class="c1">// distance matrix (Euclidean)</span>
<span class="linenos"> 7</span>   <span class="c1">// load data from Scanner</span>
<span class="linenos"> 8</span>   <span class="kt">void</span> <span class="nf">load</span><span class="p">(</span><span class="n">Scanner</span><span class="o">&amp;</span> <span class="n">scanner</span><span class="p">)</span>
<span class="linenos"> 9</span>   <span class="p">{</span>
<span class="linenos">10</span>      <span class="n">n</span> <span class="o">=</span> <span class="o">*</span><span class="n">scanner</span><span class="p">.</span><span class="n">nextInt</span><span class="p">();</span>   <span class="c1">// reads number of clients</span>
<span class="linenos">11</span>      <span class="n">dist</span> <span class="o">=</span> <span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span> <span class="c1">// initializes n x n matrix</span>
<span class="linenos">12</span>      <span class="c1">//</span>
<span class="linenos">13</span>      <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">xvalues</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="linenos">14</span>      <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">yvalues</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="linenos">15</span>      <span class="c1">//</span>
<span class="linenos">16</span>      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">17</span>         <span class="n">scanner</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="linenos">18</span>         <span class="n">xvalues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">scanner</span><span class="p">.</span><span class="n">nextDouble</span><span class="p">();</span> <span class="c1">// reads x</span>
<span class="linenos">19</span>         <span class="n">yvalues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">scanner</span><span class="p">.</span><span class="n">nextDouble</span><span class="p">();</span> <span class="c1">// reads y</span>
<span class="linenos">20</span>      <span class="p">}</span>
<span class="linenos">21</span>      <span class="c1">// calculate distance values, for every client pair (i,j)</span>
<span class="linenos">22</span>      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos">23</span>         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="linenos">24</span>            <span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="o">::</span><span class="n">round</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">xvalues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">yvalues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">xvalues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">yvalues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">)));</span>
<span class="linenos">25</span>   <span class="p">}</span>
<span class="linenos">26</span>   <span class="c1">// euclidean distance (double as return)</span>
<span class="linenos">27</span>   <span class="kt">double</span> <span class="nf">distance</span><span class="p">(</span><span class="kt">double</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x2</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y2</span><span class="p">)</span>
<span class="linenos">28</span>   <span class="p">{</span>
<span class="linenos">29</span>      <span class="k">return</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">));</span>
<span class="linenos">30</span>   <span class="p">}</span>
<span class="linenos">31</span><span class="p">};</span>
<span class="linenos">32</span><span class="c1">// Create TSP Problem Context</span>
<span class="linenos">33</span><span class="n">ProblemContext</span> <span class="n">pTSP</span><span class="p">;</span>
</pre></div>
</div>
<p>Finally, we declare a global object <code class="code docutils literal notranslate"><span class="pre">ProblemContext</span> <span class="pre">pTSP</span></code> (for simplicity), that includes all data.</p>
</section>
<section id="evaluation">
<h3>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline"></a></h3>
<p>Objective calculation can be done by using Functional Core class FEvaluator, which is a huge
simplification from OptFrame Core components Evaluator (for single objectives) and
GeneralEvaluator (for single and multiple objectives).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>
<span class="linenos"> 2</span><span class="n">fevaluate</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">s</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="p">{</span>
<span class="linenos"> 4</span>   <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 5</span>   <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 6</span>      <span class="n">f</span> <span class="o">+=</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">dist</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
<span class="linenos"> 7</span>   <span class="n">f</span> <span class="o">+=</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">dist</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="kt">int</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="linenos"> 8</span>   <span class="k">return</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span> <span class="n">f</span> <span class="p">};</span>
<span class="linenos"> 9</span><span class="p">}</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c1">// Evaluate</span>
<span class="linenos">12</span><span class="n">FEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="p">,</span> <span class="n">MinOrMax</span><span class="o">::</span><span class="n">MINIMIZE</span><span class="o">&gt;</span>
<span class="linenos">13</span>  <span class="n">eval</span><span class="p">{</span>
<span class="linenos">14</span>     <span class="n">fevaluate</span>
<span class="linenos">15</span>  <span class="p">};</span>
</pre></div>
</div>
</section>
</section>
<section id="search-methods-based-on-neighborhoods">
<h2>Search methods based on neighborhoods<a class="headerlink" href="#search-methods-based-on-neighborhoods" title="Permalink to this headline"></a></h2>
<p>The next components will depend on the type of search method used, we start with
neighborhood-based search techniques.</p>
<section id="random-constructive">
<h3>Random constructive<a class="headerlink" href="#random-constructive" title="Permalink to this headline"></a></h3>
<p>In a similar manner with Knapsack example (on Quickstart part 1), we define
a random solution generator.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>
<span class="linenos"> 2</span><span class="n">frandom</span><span class="p">()</span>
<span class="linenos"> 3</span><span class="p">{</span>
<span class="linenos"> 4</span>   <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span> <span class="c1">// get information from context</span>
<span class="linenos"> 5</span>   <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 6</span>      <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos"> 7</span>   <span class="n">std</span><span class="o">::</span><span class="n">random_shuffle</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<span class="linenos"> 8</span>   <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="p">}</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c1">// Generate random solution</span>
<span class="linenos">12</span><span class="n">FConstructive</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">crand</span><span class="p">{</span>
<span class="linenos">13</span>   <span class="n">frandom</span>
<span class="linenos">14</span><span class="p">};</span>
</pre></div>
</div>
</section>
<section id="first-move-operator-swap">
<h3>First move operator: Swap<a class="headerlink" href="#first-move-operator-swap" title="Permalink to this headline"></a></h3>
<p>We start with a Move operator capable of exchanging two elements from a given TSP solution.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span>
<span class="linenos"> 2</span><span class="n">fApplySwap</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">moveData</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="p">{</span>
<span class="linenos"> 4</span>   <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">moveData</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
<span class="linenos"> 5</span>   <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">moveData</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
<span class="linenos"> 6</span>   <span class="c1">// perform swap of clients i and j</span>
<span class="linenos"> 7</span>   <span class="kt">int</span> <span class="n">aux</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">first</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<span class="linenos"> 8</span>   <span class="n">se</span><span class="p">.</span><span class="n">first</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">first</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 9</span>   <span class="n">se</span><span class="p">.</span><span class="n">first</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">;</span>
<span class="linenos">10</span>   <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="c1">// return a reverse move (&#39;undo&#39; move)s</span>
<span class="linenos">11</span><span class="p">}</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1">// Swap move</span>
<span class="linenos">14</span><span class="k">using</span> <span class="n">MoveSwap</span> <span class="o">=</span> <span class="n">FMove</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">&gt;</span><span class="p">;</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span>
<span class="linenos">17</span><span class="n">makeMoveSwap</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span>
<span class="linenos">18</span><span class="p">{</span>
<span class="linenos">19</span>   <span class="k">return</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">MoveSwap</span><span class="p">{</span> <span class="n">make_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">fApplySwap</span> <span class="p">});</span>
<span class="linenos">20</span><span class="p">}</span>
</pre></div>
</div>
<p>We have four types of neighborhood definitions in OptFrame (NS, NSFind, NSSeq and NSEnum), but
two major are NS and NSSeq.</p>
<p>NS works well for random neighborhoods, with no intent of explicitly
visiting all possible neighbors (also useful for continuous or infinite neighborhoods).
Swap move and NS definition can be seen below.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span>
<span class="linenos"> 2</span><span class="n">fRandomSwap</span><span class="p">(</span><span class="k">const</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="p">{</span>
<span class="linenos"> 4</span>   <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos"> 5</span>   <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos"> 6</span>   <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 7</span>      <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos"> 8</span>      <span class="n">j</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos"> 9</span>   <span class="p">}</span>
<span class="linenos">10</span>   <span class="k">return</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">makeMoveSwap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
<span class="linenos">11</span><span class="p">}</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1">// Swap move (NS)</span>
<span class="linenos">14</span><span class="n">FNS</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">nsswap</span><span class="p">{</span>
<span class="linenos">15</span>   <span class="n">fRandomSwap</span>
<span class="linenos">16</span><span class="p">};</span>
</pre></div>
</div>
<p>We now define the NSSeq neighborhood with a explicit iterator definition, that requires four
operations: first (initializes first valid move), next (skips to next valid move),
current (returns current move) and isDone (indicates if no move exists).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">//</span>
<span class="linenos"> 2</span><span class="n">sref</span><span class="o">&lt;</span><span class="n">NSSeq</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="n">nsseq2</span><span class="p">{</span>
<span class="linenos"> 3</span>   <span class="k">new</span> <span class="n">FNSSeq</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">&gt;</span><span class="p">{</span>
<span class="linenos"> 4</span>     <span class="p">[](</span><span class="k">const</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
<span class="linenos"> 5</span>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos"> 6</span>        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos"> 7</span>        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 8</span>           <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos"> 9</span>           <span class="n">j</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos">10</span>        <span class="p">}</span>
<span class="linenos">11</span>        <span class="k">return</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">makeMoveSwap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
<span class="linenos">12</span>     <span class="p">},</span>
<span class="linenos">13</span>     <span class="c1">// iterator initialization (fGenerator)</span>
<span class="linenos">14</span>     <span class="p">[](</span><span class="k">const</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="linenos">15</span>        <span class="k">return</span> <span class="nf">make_pair</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
<span class="linenos">16</span>     <span class="p">},</span>
<span class="linenos">17</span>     <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span> <span class="p">{</span>
<span class="linenos">18</span>        <span class="c1">//void (*fFirst)(IMS&amp;),                   // iterator.first()</span>
<span class="linenos">19</span>        <span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">20</span>        <span class="n">p</span><span class="p">.</span><span class="n">second</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos">21</span>     <span class="p">},</span>
<span class="linenos">22</span>     <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span> <span class="p">{</span>
<span class="linenos">23</span>        <span class="c1">//void (*fNext)(IMS&amp;),                    // iterator.next()</span>
<span class="linenos">24</span>        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos">25</span>           <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="o">++</span><span class="p">;</span>
<span class="linenos">26</span>        <span class="k">else</span> <span class="p">{</span>
<span class="linenos">27</span>           <span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="o">++</span><span class="p">;</span>
<span class="linenos">28</span>           <span class="n">p</span><span class="p">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos">29</span>        <span class="p">}</span>
<span class="linenos">30</span>     <span class="p">},</span>
<span class="linenos">31</span>     <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span> <span class="p">{</span>
<span class="linenos">32</span>        <span class="c1">//bool (*fIsDone)(IMS&amp;),                  // iterator.isDone()</span>
<span class="linenos">33</span>        <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">&gt;=</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos">34</span>     <span class="p">},</span>
<span class="linenos">35</span>     <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
<span class="linenos">36</span>        <span class="c1">//uptr&lt;Move&lt;XES&gt;&gt; (*fCurrent)(IMS&amp;)       // iterator.current()</span>
<span class="linenos">37</span>        <span class="k">return</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">makeMoveSwap</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">));</span>
<span class="linenos">38</span>     <span class="p">}</span> <span class="p">}</span> <span class="c1">// FNSSeq</span>
<span class="linenos">39</span><span class="p">};</span>       <span class="c1">// nsseq2</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>According to groundbreaking ideas from Variable Neighborhood Search community, the user
should create multiple neighborhoods, with different ideas in each one, in order to better
explore the solution space.</p>
</div>
<p>At this point, we quickly demonstrate how novel C++20 features, such as Coroutines,
have improved OptFrame in latest versions (named FxCore library).
We note that all four iterator operations (first, next, current and isDone) are made
available quite naturally with a single coroutine generator that executes co_yield for
each available move.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">// THIS IS ONLY AVAILABLE WITH OptFrame FxCore and C++20 -fcoroutines</span>
<span class="linenos"> 2</span><span class="c1">// Swap move (NSSeq) - with &quot;Fancy&quot; iterator (coroutines)</span>
<span class="linenos"> 3</span><span class="k">using</span> <span class="n">NSSeqSwapFancy</span> <span class="o">=</span> <span class="n">FxNSSeqFancy</span><span class="o">&lt;</span>
<span class="linenos"> 4</span>  <span class="n">ESolutionTSP</span><span class="p">,</span>
<span class="linenos"> 5</span>  <span class="p">[](</span><span class="k">const</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
<span class="linenos"> 6</span>     <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos"> 7</span>     <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos"> 8</span>     <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 9</span>        <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos">10</span>        <span class="n">j</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos">11</span>     <span class="p">}</span>
<span class="linenos">12</span>     <span class="k">return</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">MoveSwap</span><span class="p">{</span> <span class="n">make_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="p">});</span>
<span class="linenos">13</span>  <span class="p">},</span>
<span class="linenos">14</span>  <span class="p">[](</span><span class="k">const</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;*&gt;</span> <span class="p">{</span>
<span class="linenos">15</span>     <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos">16</span>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="linenos">17</span>           <span class="k">co_yield</span> <span class="k">new</span> <span class="n">MoveSwap</span><span class="p">{</span> <span class="n">make_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="p">};</span> <span class="c1">// implicit unique_ptr requirements</span>
<span class="linenos">18</span>  <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>We will explore more of these bleeding-edge tools in an advanced topic.</p>
</section>
<section id="complete-example-for-tsp-components">
<h3>Complete Example for TSP Components<a class="headerlink" href="#complete-example-for-tsp-components" title="Permalink to this headline"></a></h3>
<p>For simplicity, we separate the main TSP components in a file named <code class="code docutils literal notranslate"><span class="pre">TSP-fcore.hpp</span></code>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>This example could be made in a single file, to be even simpler. However, we recommend users to have
a clear separation for the header declaration of <em>FCore components</em> (on <code class="code docutils literal notranslate"><span class="pre">TSP-fcore.hpp</span></code>)
from the <code class="code docutils literal notranslate"><span class="pre">main()</span></code> entrypoint depending on method used, e.g., <code class="code docutils literal notranslate"><span class="pre">mainTSP-fcore-ils.cpp</span></code> or <code class="code docutils literal notranslate"><span class="pre">mainTSP-fcore-brkga.cpp</span></code>.</p>
</div>
<p><em>TSP-fcore.hpp</em></p>
<p><code class="code docutils literal notranslate"><span class="pre">File</span> <span class="pre">'TSP-fcore.hpp'</span> <span class="pre">located</span> <span class="pre">in</span> <span class="pre">'demo/03_QuickstartTSP_VNS_BRKGA/'</span></code></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#pragma once</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="linenos">  4</span><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"></span>
<span class="linenos">  5</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="cp">#include</span> <span class="cpf">&lt;OptFCore/FCore.hpp&gt;</span><span class="cp"></span>
<span class="linenos">  8</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Core.hpp&gt;</span><span class="cp"></span>
<span class="linenos">  9</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Heuristics/Heuristics.hpp&gt;</span><span class="c1"> // many metaheuristics here...</span><span class="cp"></span>
<span class="linenos"> 10</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Scanner++/Scanner.hpp&gt;</span><span class="cp"></span>
<span class="linenos"> 11</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Util/Matrix.hpp&gt;</span><span class="cp"></span>
<span class="linenos"> 12</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/printable/printable.hpp&gt;</span><span class="cp"></span>
<span class="linenos"> 13</span>
<span class="linenos"> 14</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="linenos"> 15</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">optframe</span><span class="p">;</span>
<span class="linenos"> 16</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">scannerpp</span><span class="p">;</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="c1">// define TSP solution type as &#39;vector&lt;int&gt;&#39;, using &#39;double&#39; as evaluation type</span>
<span class="linenos"> 19</span><span class="k">using</span> <span class="n">ESolutionTSP1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span>
<span class="linenos"> 20</span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="c1">// first part of search space element: solution (representation)</span>
<span class="linenos"> 21</span>  <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>   <span class="c1">// second part of search space element: evaluation (objective value)</span>
<span class="linenos"> 22</span>  <span class="o">&gt;</span><span class="p">;</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">X</span> <span class="o">=</span> <span class="n">nullptr_t</span><span class="o">&gt;</span>
<span class="linenos"> 25</span><span class="k">using</span> <span class="n">ESolutionTSP2</span> <span class="o">=</span> <span class="n">ESolutionTSP1</span><span class="p">;</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">using</span> <span class="n">ESolutionTSP</span> <span class="o">=</span> <span class="n">ESolutionTSP2</span><span class="o">&lt;&gt;</span><span class="p">;</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span><span class="c1">// TSP problem context and data reads</span>
<span class="linenos"> 30</span><span class="k">class</span> <span class="nc">ProblemContext</span>
<span class="linenos"> 31</span><span class="p">{</span>
<span class="linenos"> 32</span><span class="k">public</span><span class="o">:</span>
<span class="linenos"> 33</span>   <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>            <span class="c1">// number of clients</span>
<span class="linenos"> 34</span>   <span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dist</span><span class="p">;</span> <span class="c1">// distance matrix (Euclidean)</span>
<span class="linenos"> 35</span>   <span class="c1">// load data from Scanner</span>
<span class="linenos"> 36</span>   <span class="kt">void</span> <span class="nf">load</span><span class="p">(</span><span class="n">Scanner</span><span class="o">&amp;</span> <span class="n">scanner</span><span class="p">)</span>
<span class="linenos"> 37</span>   <span class="p">{</span>
<span class="linenos"> 38</span>      <span class="n">n</span> <span class="o">=</span> <span class="o">*</span><span class="n">scanner</span><span class="p">.</span><span class="n">nextInt</span><span class="p">();</span>   <span class="c1">// reads number of clients</span>
<span class="linenos"> 39</span>      <span class="n">dist</span> <span class="o">=</span> <span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span> <span class="c1">// initializes n x n matrix</span>
<span class="linenos"> 40</span>      <span class="c1">//</span>
<span class="linenos"> 41</span>      <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">xvalues</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="linenos"> 42</span>      <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">yvalues</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="linenos"> 43</span>      <span class="c1">//</span>
<span class="linenos"> 44</span>      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 45</span>         <span class="n">scanner</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="linenos"> 46</span>         <span class="n">xvalues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">scanner</span><span class="p">.</span><span class="n">nextDouble</span><span class="p">();</span> <span class="c1">// reads x</span>
<span class="linenos"> 47</span>         <span class="n">yvalues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">scanner</span><span class="p">.</span><span class="n">nextDouble</span><span class="p">();</span> <span class="c1">// reads y</span>
<span class="linenos"> 48</span>      <span class="p">}</span>
<span class="linenos"> 49</span>      <span class="c1">// calculate distance values, for every client pair (i,j)</span>
<span class="linenos"> 50</span>      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 51</span>         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 52</span>            <span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="o">::</span><span class="n">round</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">xvalues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">yvalues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">xvalues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">yvalues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">)));</span>
<span class="linenos"> 53</span>   <span class="p">}</span>
<span class="linenos"> 54</span>   <span class="c1">// euclidean distance (double as return)</span>
<span class="linenos"> 55</span>   <span class="kt">double</span> <span class="nf">distance</span><span class="p">(</span><span class="kt">double</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x2</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y2</span><span class="p">)</span>
<span class="linenos"> 56</span>   <span class="p">{</span>
<span class="linenos"> 57</span>      <span class="k">return</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">));</span>
<span class="linenos"> 58</span>   <span class="p">}</span>
<span class="linenos"> 59</span><span class="p">};</span>
<span class="linenos"> 60</span><span class="c1">// Create TSP Problem Context</span>
<span class="linenos"> 61</span><span class="n">ProblemContext</span> <span class="n">pTSP</span><span class="p">;</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span><span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>
<span class="linenos"> 64</span><span class="n">fevaluate</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">s</span><span class="p">)</span>
<span class="linenos"> 65</span><span class="p">{</span>
<span class="linenos"> 66</span>   <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 67</span>   <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 68</span>      <span class="n">f</span> <span class="o">+=</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">dist</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
<span class="linenos"> 69</span>   <span class="n">f</span> <span class="o">+=</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">dist</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="kt">int</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="linenos"> 70</span>   <span class="k">return</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span> <span class="n">f</span> <span class="p">};</span>
<span class="linenos"> 71</span><span class="p">}</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span><span class="c1">// Evaluate</span>
<span class="linenos"> 74</span><span class="n">FEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="p">,</span> <span class="n">MinOrMax</span><span class="o">::</span><span class="n">MINIMIZE</span><span class="o">&gt;</span>
<span class="linenos"> 75</span>  <span class="n">eval</span><span class="p">{</span>
<span class="linenos"> 76</span>     <span class="n">fevaluate</span>
<span class="linenos"> 77</span>  <span class="p">};</span>
<span class="linenos"> 78</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>
<span class="linenos"> 79</span><span class="n">frandom</span><span class="p">()</span>
<span class="linenos"> 80</span><span class="p">{</span>
<span class="linenos"> 81</span>   <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span> <span class="c1">// get information from context</span>
<span class="linenos"> 82</span>   <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 83</span>      <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos"> 84</span>   <span class="n">std</span><span class="o">::</span><span class="n">random_shuffle</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<span class="linenos"> 85</span>   <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
<span class="linenos"> 86</span><span class="p">}</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="c1">// Generate random solution</span>
<span class="linenos"> 89</span><span class="n">FConstructive</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">crand</span><span class="p">{</span>
<span class="linenos"> 90</span>   <span class="n">frandom</span>
<span class="linenos"> 91</span><span class="p">};</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span>
<span class="linenos"> 94</span><span class="n">fApplySwap</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">moveData</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span>
<span class="linenos"> 95</span><span class="p">{</span>
<span class="linenos"> 96</span>   <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">moveData</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
<span class="linenos"> 97</span>   <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">moveData</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
<span class="linenos"> 98</span>   <span class="c1">// perform swap of clients i and j</span>
<span class="linenos"> 99</span>   <span class="kt">int</span> <span class="n">aux</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">first</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<span class="linenos">100</span>   <span class="n">se</span><span class="p">.</span><span class="n">first</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">first</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos">101</span>   <span class="n">se</span><span class="p">.</span><span class="n">first</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">;</span>
<span class="linenos">102</span>   <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="c1">// return a reverse move (&#39;undo&#39; move)s</span>
<span class="linenos">103</span><span class="p">}</span>
<span class="linenos">104</span>
<span class="linenos">105</span><span class="c1">// Swap move</span>
<span class="linenos">106</span><span class="k">using</span> <span class="n">MoveSwap</span> <span class="o">=</span> <span class="n">FMove</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">&gt;</span><span class="p">;</span>
<span class="linenos">107</span>
<span class="linenos">108</span><span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span>
<span class="linenos">109</span><span class="n">makeMoveSwap</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span>
<span class="linenos">110</span><span class="p">{</span>
<span class="linenos">111</span>   <span class="k">return</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">MoveSwap</span><span class="p">{</span> <span class="n">make_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">fApplySwap</span> <span class="p">});</span>
<span class="linenos">112</span><span class="p">}</span>
<span class="linenos">113</span><span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span>
<span class="linenos">114</span><span class="n">fRandomSwap</span><span class="p">(</span><span class="k">const</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span>
<span class="linenos">115</span><span class="p">{</span>
<span class="linenos">116</span>   <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos">117</span>   <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos">118</span>   <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">119</span>      <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos">120</span>      <span class="n">j</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos">121</span>   <span class="p">}</span>
<span class="linenos">122</span>   <span class="k">return</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">makeMoveSwap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
<span class="linenos">123</span><span class="p">}</span>
<span class="linenos">124</span>
<span class="linenos">125</span><span class="c1">// Swap move (NS)</span>
<span class="linenos">126</span><span class="n">FNS</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">nsswap</span><span class="p">{</span>
<span class="linenos">127</span>   <span class="n">fRandomSwap</span>
<span class="linenos">128</span><span class="p">};</span>
<span class="linenos">129</span>
<span class="linenos">130</span><span class="c1">//</span>
<span class="linenos">131</span><span class="n">sref</span><span class="o">&lt;</span><span class="n">NSSeq</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="n">nsseq2</span><span class="p">{</span>
<span class="linenos">132</span>   <span class="k">new</span> <span class="n">FNSSeq</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">&gt;</span><span class="p">{</span>
<span class="linenos">133</span>     <span class="p">[](</span><span class="k">const</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
<span class="linenos">134</span>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos">135</span>        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos">136</span>        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">137</span>           <span class="n">i</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos">138</span>           <span class="n">j</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
<span class="linenos">139</span>        <span class="p">}</span>
<span class="linenos">140</span>        <span class="k">return</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">makeMoveSwap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
<span class="linenos">141</span>     <span class="p">},</span>
<span class="linenos">142</span>     <span class="c1">// iterator initialization (fGenerator)</span>
<span class="linenos">143</span>     <span class="p">[](</span><span class="k">const</span> <span class="n">ESolutionTSP</span><span class="o">&amp;</span> <span class="n">se</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="linenos">144</span>        <span class="k">return</span> <span class="nf">make_pair</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
<span class="linenos">145</span>     <span class="p">},</span>
<span class="linenos">146</span>     <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span> <span class="p">{</span>
<span class="linenos">147</span>        <span class="c1">//void (*fFirst)(IMS&amp;),                   // iterator.first()</span>
<span class="linenos">148</span>        <span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">149</span>        <span class="n">p</span><span class="p">.</span><span class="n">second</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos">150</span>     <span class="p">},</span>
<span class="linenos">151</span>     <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span> <span class="p">{</span>
<span class="linenos">152</span>        <span class="c1">//void (*fNext)(IMS&amp;),                    // iterator.next()</span>
<span class="linenos">153</span>        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos">154</span>           <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="o">++</span><span class="p">;</span>
<span class="linenos">155</span>        <span class="k">else</span> <span class="p">{</span>
<span class="linenos">156</span>           <span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="o">++</span><span class="p">;</span>
<span class="linenos">157</span>           <span class="n">p</span><span class="p">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos">158</span>        <span class="p">}</span>
<span class="linenos">159</span>     <span class="p">},</span>
<span class="linenos">160</span>     <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span> <span class="p">{</span>
<span class="linenos">161</span>        <span class="c1">//bool (*fIsDone)(IMS&amp;),                  // iterator.isDone()</span>
<span class="linenos">162</span>        <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">&gt;=</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos">163</span>     <span class="p">},</span>
<span class="linenos">164</span>     <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
<span class="linenos">165</span>        <span class="c1">//uptr&lt;Move&lt;XES&gt;&gt; (*fCurrent)(IMS&amp;)       // iterator.current()</span>
<span class="linenos">166</span>        <span class="k">return</span> <span class="n">uptr</span><span class="o">&lt;</span><span class="n">Move</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">makeMoveSwap</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">));</span>
<span class="linenos">167</span>     <span class="p">}</span> <span class="p">}</span> <span class="c1">// FNSSeq</span>
<span class="linenos">168</span><span class="p">};</span>       <span class="c1">// nsseq2</span>
</pre></div>
</div>
</section>
<section id="exploring-with-neighborhood-exploration">
<h3>Exploring with neighborhood exploration<a class="headerlink" href="#exploring-with-neighborhood-exploration" title="Permalink to this headline"></a></h3>
<p>OptFrame supports several strategies for neighborhood exploration, such as:
First Improvement, Best Improvement, Random Selection and Multi Improvement.
We can also combine several local search strategies in a multiple strategy
called Variable Neighborhood Descent (VND).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">int</span>
<span class="linenos"> 2</span><span class="nf">main</span><span class="p">()</span>
<span class="linenos"> 3</span><span class="p">{</span>
<span class="linenos"> 4</span>   <span class="n">srand</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// using system random (weak... just an example!)</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>   <span class="c1">// load data into problem context &#39;pTSP&#39;</span>
<span class="linenos"> 7</span>   <span class="n">Scanner</span> <span class="n">scanner</span><span class="p">{</span> <span class="s">&quot;5</span><span class="se">\n</span><span class="s">1 10 10</span><span class="se">\n</span><span class="s">2 20 20</span><span class="se">\n</span><span class="s">3 30 30</span><span class="se">\n</span><span class="s">4 40 40</span><span class="se">\n</span><span class="s">5 50 50</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">};</span>
<span class="linenos"> 8</span>   <span class="n">pTSP</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">scanner</span><span class="p">);</span>
<span class="linenos"> 9</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">dist</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">10</span>
<span class="linenos">11</span>   <span class="c1">// evaluator</span>
<span class="linenos">12</span>   <span class="c1">// TSPEval ev;</span>
<span class="linenos">13</span>   <span class="c1">//</span>
<span class="linenos">14</span>   <span class="c1">// create simple solution</span>
<span class="linenos">15</span>   <span class="c1">// TSPRandom crand;</span>
<span class="linenos">16</span>   <span class="c1">//</span>
<span class="linenos">17</span>   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">sol</span> <span class="o">=</span> <span class="o">*</span><span class="n">crand</span><span class="p">.</span><span class="n">generateSolution</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">18</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sol</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">19</span>
<span class="linenos">20</span>   <span class="c1">// evaluation value and store on ESolution pair</span>
<span class="linenos">21</span>   <span class="n">ESolutionTSP</span> <span class="n">esol</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">eval</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">sol</span><span class="p">));</span>
<span class="linenos">22</span>   <span class="n">esol</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">print</span><span class="p">();</span> <span class="c1">// print evaluation</span>
<span class="linenos">23</span>
<span class="linenos">24</span>   <span class="c1">// swap 0 with 1</span>
<span class="linenos">25</span>   <span class="n">MoveSwap</span> <span class="n">move</span><span class="p">{</span> <span class="n">make_pair</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fApplySwap</span> <span class="p">};</span>
<span class="linenos">26</span>   <span class="n">move</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">27</span>
<span class="linenos">28</span>   <span class="c1">// NSSwap nsswap;</span>
<span class="linenos">29</span>   <span class="c1">// move for solution &#39;esol&#39;</span>
<span class="linenos">30</span>   <span class="k">auto</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">nsswap</span><span class="p">.</span><span class="n">randomMove</span><span class="p">(</span><span class="n">esol</span><span class="p">);</span>
<span class="linenos">31</span>   <span class="n">m1</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">32</span>
<span class="linenos">33</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">34</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;begin listing NSSeqSwapFancy&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">35</span>   <span class="c1">//</span>
<span class="linenos">36</span>   <span class="k">auto</span> <span class="n">it1</span> <span class="o">=</span> <span class="n">nsseq2</span><span class="o">-&gt;</span><span class="n">getIterator</span><span class="p">(</span><span class="n">esol</span><span class="p">);</span>
<span class="linenos">37</span>   <span class="k">for</span> <span class="p">(</span><span class="n">it1</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">();</span> <span class="o">!</span><span class="n">it1</span><span class="o">-&gt;</span><span class="n">isDone</span><span class="p">();</span> <span class="n">it1</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">())</span>
<span class="linenos">38</span>      <span class="n">it1</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">39</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;end listing NSSeqSwapFancy&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">40</span>
<span class="linenos">41</span>   <span class="c1">// Random number generator</span>
<span class="linenos">42</span>   <span class="n">RandGen</span> <span class="n">rg</span><span class="p">;</span>                       <span class="c1">// stack version</span>
<span class="linenos">43</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">RandGen</span><span class="o">&gt;</span> <span class="n">rg2</span><span class="p">{</span> <span class="k">new</span> <span class="n">RandGen</span> <span class="p">};</span> <span class="c1">// heap version (safely shared)</span>
<span class="linenos">44</span>   <span class="c1">// testing simulated annealing</span>
<span class="linenos">45</span>   <span class="n">BasicInitialSearch</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">initRand</span><span class="p">(</span><span class="n">crand</span><span class="p">,</span> <span class="n">eval</span><span class="p">);</span>
<span class="linenos">46</span>
<span class="linenos">47</span>   <span class="n">vsref</span><span class="o">&lt;</span><span class="n">LocalSearch</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="n">ns_list</span><span class="p">;</span>
<span class="linenos">48</span>   <span class="n">Evaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">::</span><span class="n">first_type</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">::</span><span class="n">second_type</span><span class="o">&gt;*</span> <span class="n">ev2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="p">,</span> <span class="n">MinOrMax</span><span class="o">::</span><span class="n">MINIMIZE</span><span class="o">&gt;</span><span class="p">{</span> <span class="n">fevaluate</span> <span class="p">};</span>
<span class="linenos">49</span>   <span class="n">GeneralEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;*</span> <span class="n">gev2</span> <span class="o">=</span> <span class="p">(</span><span class="n">GeneralEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">ev2</span><span class="p">;</span>
<span class="linenos">50</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">GeneralEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="n">eval2</span><span class="p">(</span><span class="n">gev2</span><span class="p">);</span>
<span class="linenos">51</span>   <span class="n">ns_list</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="k">new</span> <span class="n">BestImprovement</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span><span class="p">(</span><span class="n">eval2</span><span class="p">,</span> <span class="n">nsseq2</span><span class="p">));</span>
<span class="linenos">52</span>
<span class="linenos">53</span>   <span class="n">VariableNeighborhoodDescent</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">VND</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span> <span class="n">ns_list</span><span class="p">);</span>
<span class="linenos">54</span>   <span class="c1">// VND.setVerbose();</span>
</pre></div>
</div>
<p>If one wants to build a complete metaheuristic, the Iterated Local Search (ILS) or a Variable
Neighborhood Search (VNS).
The ILS is based on general perturbation concept, so we will use the concept of Levels of
Perturbation, that are increased when stuck in a poor quality local optimum. We adopt a perturbation
strategy that tries to escape at level p by applying p+2 random moves, e.g., at level 0,
2 random moves are applied, and so on.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">//</span>
<span class="linenos"> 2</span><span class="n">ILSLPerturbationLPlus2</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">pert</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span> <span class="n">nsswap</span><span class="p">,</span> <span class="n">rg2</span><span class="p">);</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="n">IteratedLocalSearchLevels</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">ils</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span> <span class="n">initRand</span><span class="p">,</span> <span class="n">VND</span><span class="p">,</span> <span class="n">pert</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="linenos"> 5</span><span class="c1">// ils.setVerbose();</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;will start ILS for 3 seconds&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">auto</span> <span class="n">status</span> <span class="o">=</span> <span class="n">ils</span><span class="p">.</span><span class="n">search</span><span class="p">(</span>
<span class="linenos">10</span>  <span class="n">StopCriteria</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">::</span><span class="n">second_type</span><span class="o">&gt;</span><span class="p">{</span> <span class="mf">3.0</span> <span class="p">});</span> <span class="c1">// 3.0 seconds max</span>
<span class="linenos">11</span><span class="n">ESolutionTSP</span> <span class="n">best</span> <span class="o">=</span> <span class="o">*</span><span class="n">status</span><span class="p">.</span><span class="n">best</span><span class="p">;</span>
<span class="linenos">12</span><span class="c1">// best solution value</span>
<span class="linenos">13</span><span class="n">best</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">14</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;solution: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">best</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;FINISHED&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">17</span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">18</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="complete-example-for-ils">
<h3>Complete Example for ILS<a class="headerlink" href="#complete-example-for-ils" title="Permalink to this headline"></a></h3>
<p>We provide the main file for TSP ILS <code class="code docutils literal notranslate"><span class="pre">mainTSP-fcore-ils.cpp</span></code>.</p>
<p><em>mainTSP-fcore-ils.cpp</em></p>
<p><code class="code docutils literal notranslate"><span class="pre">File</span> <span class="pre">'mainTSP-fcore-ils.cpp'</span> <span class="pre">located</span> <span class="pre">in</span> <span class="pre">'demo/03_QuickstartTSP_VNS_BRKGA/'</span></code></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="linenos"> 2</span><span class="c1">//</span>
<span class="linenos"> 3</span><span class="cp">#include</span> <span class="cpf">&quot;TSP-fcore.hpp&quot;</span><span class="cp"></span>
<span class="linenos"> 4</span><span class="c1">// implementation of TSP</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Core.hpp&gt;</span><span class="cp"></span>
<span class="linenos"> 7</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Heuristics/Heuristics.hpp&gt;</span><span class="c1"> // many metaheuristics here...</span><span class="cp"></span>
<span class="linenos"> 8</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Heuristics/ILS/IteratedLocalSearchLevels.hpp&gt;</span><span class="cp"></span>
<span class="linenos"> 9</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Heuristics/LocalSearches/BestImprovement.hpp&gt;</span><span class="cp"></span>
<span class="linenos">10</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Heuristics/LocalSearches/VariableNeighborhoodDescent.hpp&gt;</span><span class="cp"></span>
<span class="linenos">11</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/LocalSearch.hpp&gt;</span><span class="cp"></span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1">// import everything on main()</span>
<span class="linenos">14</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="linenos">15</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">optframe</span><span class="p">;</span>
<span class="linenos">16</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">scannerpp</span><span class="p">;</span>
<span class="linenos">17</span><span class="c1">//using namespace TSP_fcore;</span>
<span class="linenos">18</span><span class="kt">int</span>
<span class="linenos">19</span><span class="nf">main</span><span class="p">()</span>
<span class="linenos">20</span><span class="p">{</span>
<span class="linenos">21</span>   <span class="n">srand</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// using system random (weak... just an example!)</span>
<span class="linenos">22</span>
<span class="linenos">23</span>   <span class="c1">// load data into problem context &#39;pTSP&#39;</span>
<span class="linenos">24</span>   <span class="n">Scanner</span> <span class="n">scanner</span><span class="p">{</span> <span class="s">&quot;5</span><span class="se">\n</span><span class="s">1 10 10</span><span class="se">\n</span><span class="s">2 20 20</span><span class="se">\n</span><span class="s">3 30 30</span><span class="se">\n</span><span class="s">4 40 40</span><span class="se">\n</span><span class="s">5 50 50</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">};</span>
<span class="linenos">25</span>   <span class="n">pTSP</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">scanner</span><span class="p">);</span>
<span class="linenos">26</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">dist</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">27</span>
<span class="linenos">28</span>   <span class="c1">// evaluator</span>
<span class="linenos">29</span>   <span class="c1">// TSPEval ev;</span>
<span class="linenos">30</span>   <span class="c1">//</span>
<span class="linenos">31</span>   <span class="c1">// create simple solution</span>
<span class="linenos">32</span>   <span class="c1">// TSPRandom crand;</span>
<span class="linenos">33</span>   <span class="c1">//</span>
<span class="linenos">34</span>   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">sol</span> <span class="o">=</span> <span class="o">*</span><span class="n">crand</span><span class="p">.</span><span class="n">generateSolution</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">35</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sol</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">36</span>
<span class="linenos">37</span>   <span class="c1">// evaluation value and store on ESolution pair</span>
<span class="linenos">38</span>   <span class="n">ESolutionTSP</span> <span class="n">esol</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">eval</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">sol</span><span class="p">));</span>
<span class="linenos">39</span>   <span class="n">esol</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">print</span><span class="p">();</span> <span class="c1">// print evaluation</span>
<span class="linenos">40</span>
<span class="linenos">41</span>   <span class="c1">// swap 0 with 1</span>
<span class="linenos">42</span>   <span class="n">MoveSwap</span> <span class="n">move</span><span class="p">{</span> <span class="n">make_pair</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fApplySwap</span> <span class="p">};</span>
<span class="linenos">43</span>   <span class="n">move</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">44</span>
<span class="linenos">45</span>   <span class="c1">// NSSwap nsswap;</span>
<span class="linenos">46</span>   <span class="c1">// move for solution &#39;esol&#39;</span>
<span class="linenos">47</span>   <span class="k">auto</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">nsswap</span><span class="p">.</span><span class="n">randomMove</span><span class="p">(</span><span class="n">esol</span><span class="p">);</span>
<span class="linenos">48</span>   <span class="n">m1</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">49</span>
<span class="linenos">50</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">51</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;begin listing NSSeqSwapFancy&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">52</span>   <span class="c1">//</span>
<span class="linenos">53</span>   <span class="k">auto</span> <span class="n">it1</span> <span class="o">=</span> <span class="n">nsseq2</span><span class="o">-&gt;</span><span class="n">getIterator</span><span class="p">(</span><span class="n">esol</span><span class="p">);</span>
<span class="linenos">54</span>   <span class="k">for</span> <span class="p">(</span><span class="n">it1</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">();</span> <span class="o">!</span><span class="n">it1</span><span class="o">-&gt;</span><span class="n">isDone</span><span class="p">();</span> <span class="n">it1</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">())</span>
<span class="linenos">55</span>      <span class="n">it1</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">56</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;end listing NSSeqSwapFancy&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">57</span>
<span class="linenos">58</span>   <span class="c1">// Random number generator</span>
<span class="linenos">59</span>   <span class="n">RandGen</span> <span class="n">rg</span><span class="p">;</span>                       <span class="c1">// stack version</span>
<span class="linenos">60</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">RandGen</span><span class="o">&gt;</span> <span class="n">rg2</span><span class="p">{</span> <span class="k">new</span> <span class="n">RandGen</span> <span class="p">};</span> <span class="c1">// heap version (safely shared)</span>
<span class="linenos">61</span>   <span class="c1">// testing simulated annealing</span>
<span class="linenos">62</span>   <span class="n">BasicInitialSearch</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">initRand</span><span class="p">(</span><span class="n">crand</span><span class="p">,</span> <span class="n">eval</span><span class="p">);</span>
<span class="linenos">63</span>
<span class="linenos">64</span>   <span class="n">vsref</span><span class="o">&lt;</span><span class="n">LocalSearch</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="n">ns_list</span><span class="p">;</span>
<span class="linenos">65</span>   <span class="n">Evaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">::</span><span class="n">first_type</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">::</span><span class="n">second_type</span><span class="o">&gt;*</span> <span class="n">ev2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="p">,</span> <span class="n">MinOrMax</span><span class="o">::</span><span class="n">MINIMIZE</span><span class="o">&gt;</span><span class="p">{</span> <span class="n">fevaluate</span> <span class="p">};</span>
<span class="linenos">66</span>   <span class="n">GeneralEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;*</span> <span class="n">gev2</span> <span class="o">=</span> <span class="p">(</span><span class="n">GeneralEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">ev2</span><span class="p">;</span>
<span class="linenos">67</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">GeneralEvaluator</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;&gt;</span> <span class="n">eval2</span><span class="p">(</span><span class="n">gev2</span><span class="p">);</span>
<span class="linenos">68</span>   <span class="n">ns_list</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="k">new</span> <span class="n">BestImprovement</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span><span class="p">(</span><span class="n">eval2</span><span class="p">,</span> <span class="n">nsseq2</span><span class="p">));</span>
<span class="linenos">69</span>
<span class="linenos">70</span>   <span class="n">VariableNeighborhoodDescent</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">VND</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span> <span class="n">ns_list</span><span class="p">);</span>
<span class="linenos">71</span>   <span class="c1">// VND.setVerbose();//</span>
<span class="linenos">72</span><span class="n">ILSLPerturbationLPlus2</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">pert</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span> <span class="n">nsswap</span><span class="p">,</span> <span class="n">rg2</span><span class="p">);</span>
<span class="linenos">73</span>
<span class="linenos">74</span><span class="n">IteratedLocalSearchLevels</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">&gt;</span> <span class="n">ils</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span> <span class="n">initRand</span><span class="p">,</span> <span class="n">VND</span><span class="p">,</span> <span class="n">pert</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="linenos">75</span><span class="c1">// ils.setVerbose();</span>
<span class="linenos">76</span>
<span class="linenos">77</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;will start ILS for 3 seconds&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">78</span>
<span class="linenos">79</span><span class="k">auto</span> <span class="n">status</span> <span class="o">=</span> <span class="n">ils</span><span class="p">.</span><span class="n">search</span><span class="p">(</span>
<span class="linenos">80</span>  <span class="n">StopCriteria</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="o">::</span><span class="n">second_type</span><span class="o">&gt;</span><span class="p">{</span> <span class="mf">3.0</span> <span class="p">});</span> <span class="c1">// 3.0 seconds max</span>
<span class="linenos">81</span><span class="n">ESolutionTSP</span> <span class="n">best</span> <span class="o">=</span> <span class="o">*</span><span class="n">status</span><span class="p">.</span><span class="n">best</span><span class="p">;</span>
<span class="linenos">82</span><span class="c1">// best solution value</span>
<span class="linenos">83</span><span class="n">best</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">84</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;solution: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">best</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">85</span>
<span class="linenos">86</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;FINISHED&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">87</span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">88</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="search-methods-based-on-random-keys">
<h2>Search methods based on random keys<a class="headerlink" href="#search-methods-based-on-random-keys" title="Permalink to this headline"></a></h2>
<p>We finish with the Biased Random Key Genetic Algorithm (BRKGA), a simple metaheuristic
inspired by classic Genetic Algorithm, using the solution representation of $n$ Random Keys,
which are $[0,1]^n$ float values.</p>
<section id="random-key-generation">
<h3>Random key generation<a class="headerlink" href="#random-key-generation" title="Permalink to this headline"></a></h3>
<p>The BRKGA requires an initial solution generator, which is in this case, $n$ random [0,1] floats.
This can be done automatically by the method (since its trivial do generate $n$ [0,1] random numbers),
but we choose to demonstrate manually (by inheriting from OptFrame Core class Initial Population).</p>
<p>This is good to tune the degree of randomness (number of random digits) and also the random function used.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span> <span class="nc">MyRandomKeysInitPop</span> <span class="o">:</span> <span class="k">public</span> <span class="n">InitialPopulation</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&gt;</span>
<span class="linenos"> 2</span><span class="p">{</span>
<span class="linenos"> 3</span>   <span class="k">using</span> <span class="n">RSK</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">private</span><span class="o">:</span>
<span class="linenos"> 6</span>   <span class="kt">int</span> <span class="n">sz</span><span class="p">;</span>
<span class="linenos"> 7</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">RandGen</span><span class="o">&gt;</span> <span class="n">rg</span><span class="p">;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">public</span><span class="o">:</span>
<span class="linenos">10</span>   <span class="n">MyRandomKeysInitPop</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="n">sref</span><span class="o">&lt;</span><span class="n">RandGen</span><span class="o">&gt;</span> <span class="n">_rg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandGen</span><span class="p">)</span>
<span class="linenos">11</span>     <span class="o">:</span> <span class="n">sz</span><span class="p">{</span> <span class="n">size</span> <span class="p">}</span>
<span class="linenos">12</span>     <span class="p">,</span> <span class="n">rg</span><span class="p">{</span> <span class="n">_rg</span> <span class="p">}</span>
<span class="linenos">13</span>   <span class="p">{</span>
<span class="linenos">14</span>   <span class="p">}</span>
<span class="linenos">15</span>
<span class="linenos">16</span>   <span class="c1">// copy constructor</span>
<span class="linenos">17</span>   <span class="n">MyRandomKeysInitPop</span><span class="p">(</span><span class="k">const</span> <span class="n">MyRandomKeysInitPop</span><span class="o">&amp;</span> <span class="n">self</span><span class="p">)</span>
<span class="linenos">18</span>     <span class="o">:</span> <span class="n">sz</span><span class="p">{</span> <span class="n">self</span><span class="p">.</span><span class="n">sz</span> <span class="p">}</span>
<span class="linenos">19</span>     <span class="p">,</span> <span class="n">rg</span><span class="p">{</span> <span class="n">self</span><span class="p">.</span><span class="n">rg</span> <span class="p">}</span>
<span class="linenos">20</span>   <span class="p">{</span>
<span class="linenos">21</span>   <span class="p">}</span>
<span class="linenos">22</span>
<span class="linenos">23</span>   <span class="n">VEPopulation</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">RSK</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&gt;</span> <span class="n">generatePopulation</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">populationSize</span><span class="p">,</span> <span class="kt">double</span> <span class="n">timelimit</span><span class="p">)</span> <span class="k">override</span>
<span class="linenos">24</span>   <span class="p">{</span>
<span class="linenos">25</span>      <span class="n">VEPopulation</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">RSK</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&gt;</span> <span class="n">pop</span><span class="p">;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>      <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">populationSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">28</span>         <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vd</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="linenos">29</span>         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">sz</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="linenos">30</span>            <span class="n">vd</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rg</span><span class="o">-&gt;</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100000</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100000.0</span><span class="p">;</span>
<span class="linenos">31</span>         <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">RSK</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ind</span><span class="p">{</span> <span class="n">vd</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{}</span> <span class="p">};</span>
<span class="linenos">32</span>         <span class="n">pop</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ind</span><span class="p">);</span>
<span class="linenos">33</span>      <span class="p">}</span>
<span class="linenos">34</span>
<span class="linenos">35</span>      <span class="k">return</span> <span class="n">pop</span><span class="p">;</span>
<span class="linenos">36</span>   <span class="p">}</span>
<span class="linenos">37</span><span class="p">};</span>
</pre></div>
</div>
</section>
<section id="brkga-decoding">
<h3>BRKGA decoding<a class="headerlink" href="#brkga-decoding" title="Permalink to this headline"></a></h3>
<p>BRKGA also requires a decoder function, that maps this array of random keys into a permutation.</p>
<p>This can be easily done with Functional Core class FDecodeRK, and an interesting approach based
on sorting the keys, related to a predefined indexing of each key.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span>
<span class="linenos"> 2</span><span class="n">fDecode</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">rk</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="p">{</span>
<span class="linenos"> 4</span>   <span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">v</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="linenos"> 5</span>   <span class="c1">//</span>
<span class="linenos"> 6</span>   <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 7</span>      <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rk</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">);</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>   <span class="n">sort</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[](</span><span class="k">const</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">j</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span> <span class="p">{</span>
<span class="linenos">10</span>      <span class="k">return</span> <span class="n">i</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
<span class="linenos">11</span>   <span class="p">});</span>
<span class="linenos">12</span>
<span class="linenos">13</span>   <span class="c1">// R = vector&lt;int&gt;</span>
<span class="linenos">14</span>   <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="linenos">15</span>   <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos">16</span>      <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">;</span>
<span class="linenos">17</span>
<span class="linenos">18</span>   <span class="cm">/*</span>
<span class="linenos">19</span><span class="cm">   // ========== CHECKER ========</span>
<span class="linenos">20</span><span class="cm">   vector&lt;bool&gt; vb(v.size(), false);</span>
<span class="linenos">21</span><span class="cm">   for (unsigned i = 0; i &lt; p.size(); i++)</span>
<span class="linenos">22</span><span class="cm">      vb[p[i]] = true;</span>
<span class="linenos">23</span><span class="cm">   for (unsigned i = 0; i &lt; vb.size(); i++) {</span>
<span class="linenos">24</span><span class="cm">      if (!vb[i]) {</span>
<span class="linenos">25</span><span class="cm">         std::cout &lt;&lt; &quot;ERROR rk:&quot; &lt;&lt; rk &lt;&lt; std::endl;</span>
<span class="linenos">26</span><span class="cm">         std::cout &lt;&lt; &quot;ERROR v:&quot; &lt;&lt; v &lt;&lt; std::endl;</span>
<span class="linenos">27</span><span class="cm">         std::cout &lt;&lt; &quot;ERROR p:&quot; &lt;&lt; p &lt;&lt; std::endl;</span>
<span class="linenos">28</span><span class="cm">         std::cout &lt;&lt; &quot;ERROR vb:&quot; &lt;&lt; vb &lt;&lt; std::endl;</span>
<span class="linenos">29</span><span class="cm">      }</span>
<span class="linenos">30</span><span class="cm">      assert(vb[i]);</span>
<span class="linenos">31</span><span class="cm">   }</span>
<span class="linenos">32</span><span class="cm">   // ===== end CHECKER =====</span>
<span class="linenos">33</span><span class="cm">*/</span>
<span class="linenos">34</span>
<span class="linenos">35</span>   <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">eval</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="linenos">36</span>   <span class="k">return</span> <span class="nf">make_pair</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
<span class="linenos">37</span><span class="p">}</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="c1">// evaluator random keys (for TSP)</span>
<span class="linenos">40</span><span class="n">FDecoderRK</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">MinOrMax</span><span class="o">::</span><span class="n">MINIMIZE</span><span class="o">&gt;</span> <span class="n">decoder</span><span class="p">{</span>
<span class="linenos">41</span>   <span class="n">fDecode</span>
<span class="linenos">42</span><span class="p">};</span>
</pre></div>
</div>
</section>
<section id="brkga-with-tsp">
<h3>BRKGA with TSP<a class="headerlink" href="#brkga-with-tsp" title="Permalink to this headline"></a></h3>
<p>We are ready to build a TSP instance with 3 cities with coordinates (10,10), (20,20) and (30,30),
and invoke a BRKGA to solve it.</p>
<p>The parameters of BRKGA are: decoding function, initial solution generator, population size, number of iterations,
also rates for mutation (randomness), elite (best solutions), preference for elite solutions, and finally, a random generation method.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">int</span>
<span class="linenos"> 2</span><span class="nf">main</span><span class="p">()</span>
<span class="linenos"> 3</span><span class="p">{</span>
<span class="linenos"> 4</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">RandGen</span><span class="o">&gt;</span> <span class="n">rg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandGen</span><span class="p">;</span> <span class="c1">// avoids weird windows OS interactions</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>   <span class="c1">// load data into problem context &#39;pTSP&#39;</span>
<span class="linenos"> 7</span>   <span class="n">Scanner</span> <span class="n">scanner</span><span class="p">{</span> <span class="s">&quot;5</span><span class="se">\n</span><span class="s">1 10 10</span><span class="se">\n</span><span class="s">2 20 20</span><span class="se">\n</span><span class="s">3 30 30</span><span class="se">\n</span><span class="s">4 40 40</span><span class="se">\n</span><span class="s">5 50 50</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">};</span>
<span class="linenos"> 8</span>   <span class="n">pTSP</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">scanner</span><span class="p">);</span>
<span class="linenos"> 9</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">dist</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">10</span>
<span class="linenos">11</span>   <span class="c1">// Parameters BRKGA</span>
<span class="linenos">12</span>   <span class="c1">// (C1): Evaluator&lt;S, XEv&gt;&amp; _evaluator, int key_size, unsigned numGen, unsigned _popSize, double fracTOP, double fracBOT, double _probElitism) :</span>
<span class="linenos">13</span>
<span class="linenos">14</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">DecoderRandomKeys</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;&gt;</span> <span class="n">_decoder</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">;</span>
<span class="linenos">15</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">InitialPopulation</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">::</span><span class="n">second_type</span><span class="o">&gt;&gt;&gt;</span> <span class="n">_initPop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyRandomKeysInitPop</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">);</span> <span class="c1">// passing key_size</span>
<span class="linenos">16</span>
<span class="linenos">17</span>   <span class="c1">//eprk, pTSP.n, 1000, 30, 0.4, 0.3, 0.6</span>
<span class="linenos">18</span>   <span class="n">BRKGA</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="n">brkga</span><span class="p">(</span>
<span class="linenos">19</span>     <span class="n">_decoder</span><span class="p">,</span>
<span class="linenos">20</span>     <span class="n">MyRandomKeysInitPop</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="n">rg</span><span class="p">),</span> <span class="c1">// key_size = pTSP.n</span>
<span class="linenos">21</span>     <span class="mi">30</span><span class="p">,</span>
<span class="linenos">22</span>     <span class="mi">1000</span><span class="p">,</span>
<span class="linenos">23</span>     <span class="mf">0.4</span><span class="p">,</span>
<span class="linenos">24</span>     <span class="mf">0.3</span><span class="p">,</span>
<span class="linenos">25</span>     <span class="mf">0.6</span><span class="p">,</span>
<span class="linenos">26</span>     <span class="n">rg</span><span class="p">);</span>
<span class="linenos">27</span>
<span class="linenos">28</span>   <span class="k">auto</span> <span class="n">searchOut</span> <span class="o">=</span> <span class="n">brkga</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="mf">3.0</span><span class="p">);</span> <span class="c1">// 3.0 seconds max</span>
<span class="linenos">29</span>   <span class="n">ESolutionTSP</span> <span class="n">best</span> <span class="o">=</span> <span class="o">*</span><span class="n">searchOut</span><span class="p">.</span><span class="n">best</span><span class="p">;</span>
<span class="linenos">30</span>   <span class="c1">// best solution value</span>
<span class="linenos">31</span>   <span class="n">best</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">32</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;solution: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">best</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">33</span>
<span class="linenos">34</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;FINISHED&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">35</span>   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">36</span><span class="p">}</span>
</pre></div>
</div>
<p>The result from searchOut can be split in two parts, an error code and the returned solution
(the same as in Simulated Annealing or any other OptFrame search method).</p>
</section>
<section id="complete-example-for-brkga">
<h3>Complete Example for BRKGA<a class="headerlink" href="#complete-example-for-brkga" title="Permalink to this headline"></a></h3>
<p>We provide the main file for TSP BRKGA <code class="code docutils literal notranslate"><span class="pre">mainTSP-fcore-brkga.cpp</span></code>.</p>
<p><em>mainTSP-fcore-brkga.cpp</em></p>
<p><code class="code docutils literal notranslate"><span class="pre">File</span> <span class="pre">'mainTSP-fcore-brkga.cpp'</span> <span class="pre">located</span> <span class="pre">in</span> <span class="pre">'demo/03_QuickstartTSP_VNS_BRKGA/'</span></code></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="linenos">  2</span><span class="c1">//</span>
<span class="linenos">  3</span><span class="cp">#include</span> <span class="cpf">&quot;TSP-fcore.hpp&quot;</span><span class="cp"></span>
<span class="linenos">  4</span><span class="c1">// implementation of TSP</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Core.hpp&gt;</span><span class="cp"></span>
<span class="linenos">  7</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Heuristics/EvolutionaryAlgorithms/BRKGA.hpp&gt;</span><span class="cp"></span>
<span class="linenos">  8</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/Heuristics/Heuristics.hpp&gt;</span><span class="c1"> // many metaheuristics here...</span><span class="cp"></span>
<span class="linenos">  9</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/InitialPopulation.hpp&gt;</span><span class="cp"></span>
<span class="linenos"> 10</span><span class="cp">#include</span> <span class="cpf">&lt;OptFrame/LocalSearch.hpp&gt;</span><span class="cp"></span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="c1">// import everything on main()</span>
<span class="linenos"> 13</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="linenos"> 14</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">optframe</span><span class="p">;</span>
<span class="linenos"> 15</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">scannerpp</span><span class="p">;</span>
<span class="linenos"> 16</span><span class="c1">//using namespace TSP_fcore;</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="k">class</span> <span class="nc">MyRandomKeysInitPop</span> <span class="o">:</span> <span class="k">public</span> <span class="n">InitialPopulation</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&gt;</span>
<span class="linenos"> 19</span><span class="p">{</span>
<span class="linenos"> 20</span>   <span class="k">using</span> <span class="n">RSK</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">;</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="k">private</span><span class="o">:</span>
<span class="linenos"> 23</span>   <span class="kt">int</span> <span class="n">sz</span><span class="p">;</span>
<span class="linenos"> 24</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">RandGen</span><span class="o">&gt;</span> <span class="n">rg</span><span class="p">;</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="k">public</span><span class="o">:</span>
<span class="linenos"> 27</span>   <span class="n">MyRandomKeysInitPop</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="n">sref</span><span class="o">&lt;</span><span class="n">RandGen</span><span class="o">&gt;</span> <span class="n">_rg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandGen</span><span class="p">)</span>
<span class="linenos"> 28</span>     <span class="o">:</span> <span class="n">sz</span><span class="p">{</span> <span class="n">size</span> <span class="p">}</span>
<span class="linenos"> 29</span>     <span class="p">,</span> <span class="n">rg</span><span class="p">{</span> <span class="n">_rg</span> <span class="p">}</span>
<span class="linenos"> 30</span>   <span class="p">{</span>
<span class="linenos"> 31</span>   <span class="p">}</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span>   <span class="c1">// copy constructor</span>
<span class="linenos"> 34</span>   <span class="n">MyRandomKeysInitPop</span><span class="p">(</span><span class="k">const</span> <span class="n">MyRandomKeysInitPop</span><span class="o">&amp;</span> <span class="n">self</span><span class="p">)</span>
<span class="linenos"> 35</span>     <span class="o">:</span> <span class="n">sz</span><span class="p">{</span> <span class="n">self</span><span class="p">.</span><span class="n">sz</span> <span class="p">}</span>
<span class="linenos"> 36</span>     <span class="p">,</span> <span class="n">rg</span><span class="p">{</span> <span class="n">self</span><span class="p">.</span><span class="n">rg</span> <span class="p">}</span>
<span class="linenos"> 37</span>   <span class="p">{</span>
<span class="linenos"> 38</span>   <span class="p">}</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span>   <span class="n">VEPopulation</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">RSK</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&gt;</span> <span class="n">generatePopulation</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">populationSize</span><span class="p">,</span> <span class="kt">double</span> <span class="n">timelimit</span><span class="p">)</span> <span class="k">override</span>
<span class="linenos"> 41</span>   <span class="p">{</span>
<span class="linenos"> 42</span>      <span class="n">VEPopulation</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">RSK</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&gt;</span> <span class="n">pop</span><span class="p">;</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span>      <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">populationSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 45</span>         <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vd</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="linenos"> 46</span>         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">sz</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 47</span>            <span class="n">vd</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rg</span><span class="o">-&gt;</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100000</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100000.0</span><span class="p">;</span>
<span class="linenos"> 48</span>         <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">RSK</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ind</span><span class="p">{</span> <span class="n">vd</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{}</span> <span class="p">};</span>
<span class="linenos"> 49</span>         <span class="n">pop</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ind</span><span class="p">);</span>
<span class="linenos"> 50</span>      <span class="p">}</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span>      <span class="k">return</span> <span class="n">pop</span><span class="p">;</span>
<span class="linenos"> 53</span>   <span class="p">}</span>
<span class="linenos"> 54</span><span class="p">};</span>
<span class="linenos"> 55</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span>
<span class="linenos"> 56</span><span class="n">fDecode</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">rk</span><span class="p">)</span>
<span class="linenos"> 57</span><span class="p">{</span>
<span class="linenos"> 58</span>   <span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">v</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="linenos"> 59</span>   <span class="c1">//</span>
<span class="linenos"> 60</span>   <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 61</span>      <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rk</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">);</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>   <span class="n">sort</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[](</span><span class="k">const</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">j</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span> <span class="p">{</span>
<span class="linenos"> 64</span>      <span class="k">return</span> <span class="n">i</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
<span class="linenos"> 65</span>   <span class="p">});</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span>   <span class="c1">// R = vector&lt;int&gt;</span>
<span class="linenos"> 68</span>   <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="linenos"> 69</span>   <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 70</span>      <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">;</span>
<span class="linenos"> 71</span>
<span class="linenos"> 72</span>   <span class="cm">/*</span>
<span class="linenos"> 73</span><span class="cm">   // ========== CHECKER ========</span>
<span class="linenos"> 74</span><span class="cm">   vector&lt;bool&gt; vb(v.size(), false);</span>
<span class="linenos"> 75</span><span class="cm">   for (unsigned i = 0; i &lt; p.size(); i++)</span>
<span class="linenos"> 76</span><span class="cm">      vb[p[i]] = true;</span>
<span class="linenos"> 77</span><span class="cm">   for (unsigned i = 0; i &lt; vb.size(); i++) {</span>
<span class="linenos"> 78</span><span class="cm">      if (!vb[i]) {</span>
<span class="linenos"> 79</span><span class="cm">         std::cout &lt;&lt; &quot;ERROR rk:&quot; &lt;&lt; rk &lt;&lt; std::endl;</span>
<span class="linenos"> 80</span><span class="cm">         std::cout &lt;&lt; &quot;ERROR v:&quot; &lt;&lt; v &lt;&lt; std::endl;</span>
<span class="linenos"> 81</span><span class="cm">         std::cout &lt;&lt; &quot;ERROR p:&quot; &lt;&lt; p &lt;&lt; std::endl;</span>
<span class="linenos"> 82</span><span class="cm">         std::cout &lt;&lt; &quot;ERROR vb:&quot; &lt;&lt; vb &lt;&lt; std::endl;</span>
<span class="linenos"> 83</span><span class="cm">      }</span>
<span class="linenos"> 84</span><span class="cm">      assert(vb[i]);</span>
<span class="linenos"> 85</span><span class="cm">   }</span>
<span class="linenos"> 86</span><span class="cm">   // ===== end CHECKER =====</span>
<span class="linenos"> 87</span><span class="cm">*/</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span>   <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">eval</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="linenos"> 90</span>   <span class="k">return</span> <span class="nf">make_pair</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
<span class="linenos"> 91</span><span class="p">}</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span><span class="c1">// evaluator random keys (for TSP)</span>
<span class="linenos"> 94</span><span class="n">FDecoderRK</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Evaluation</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">MinOrMax</span><span class="o">::</span><span class="n">MINIMIZE</span><span class="o">&gt;</span> <span class="n">decoder</span><span class="p">{</span>
<span class="linenos"> 95</span>   <span class="n">fDecode</span>
<span class="linenos"> 96</span><span class="p">};</span>
<span class="linenos"> 97</span><span class="kt">int</span>
<span class="linenos"> 98</span><span class="nf">main</span><span class="p">()</span>
<span class="linenos"> 99</span><span class="p">{</span>
<span class="linenos">100</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">RandGen</span><span class="o">&gt;</span> <span class="n">rg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandGen</span><span class="p">;</span> <span class="c1">// avoids weird windows OS interactions</span>
<span class="linenos">101</span>
<span class="linenos">102</span>   <span class="c1">// load data into problem context &#39;pTSP&#39;</span>
<span class="linenos">103</span>   <span class="n">Scanner</span> <span class="n">scanner</span><span class="p">{</span> <span class="s">&quot;5</span><span class="se">\n</span><span class="s">1 10 10</span><span class="se">\n</span><span class="s">2 20 20</span><span class="se">\n</span><span class="s">3 30 30</span><span class="se">\n</span><span class="s">4 40 40</span><span class="se">\n</span><span class="s">5 50 50</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">};</span>
<span class="linenos">104</span>   <span class="n">pTSP</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">scanner</span><span class="p">);</span>
<span class="linenos">105</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTSP</span><span class="p">.</span><span class="n">dist</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">106</span>
<span class="linenos">107</span>   <span class="c1">// Parameters BRKGA</span>
<span class="linenos">108</span>   <span class="c1">// (C1): Evaluator&lt;S, XEv&gt;&amp; _evaluator, int key_size, unsigned numGen, unsigned _popSize, double fracTOP, double fracBOT, double _probElitism) :</span>
<span class="linenos">109</span>
<span class="linenos">110</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">DecoderRandomKeys</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;&gt;</span> <span class="n">_decoder</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">;</span>
<span class="linenos">111</span>   <span class="n">sref</span><span class="o">&lt;</span><span class="n">InitialPopulation</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ESolutionTSP</span><span class="o">::</span><span class="n">second_type</span><span class="o">&gt;&gt;&gt;</span> <span class="n">_initPop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyRandomKeysInitPop</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">);</span> <span class="c1">// passing key_size</span>
<span class="linenos">112</span>
<span class="linenos">113</span>   <span class="c1">//eprk, pTSP.n, 1000, 30, 0.4, 0.3, 0.6</span>
<span class="linenos">114</span>   <span class="n">BRKGA</span><span class="o">&lt;</span><span class="n">ESolutionTSP</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="n">brkga</span><span class="p">(</span>
<span class="linenos">115</span>     <span class="n">_decoder</span><span class="p">,</span>
<span class="linenos">116</span>     <span class="n">MyRandomKeysInitPop</span><span class="p">(</span><span class="n">pTSP</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="n">rg</span><span class="p">),</span> <span class="c1">// key_size = pTSP.n</span>
<span class="linenos">117</span>     <span class="mi">30</span><span class="p">,</span>
<span class="linenos">118</span>     <span class="mi">1000</span><span class="p">,</span>
<span class="linenos">119</span>     <span class="mf">0.4</span><span class="p">,</span>
<span class="linenos">120</span>     <span class="mf">0.3</span><span class="p">,</span>
<span class="linenos">121</span>     <span class="mf">0.6</span><span class="p">,</span>
<span class="linenos">122</span>     <span class="n">rg</span><span class="p">);</span>
<span class="linenos">123</span>
<span class="linenos">124</span>   <span class="k">auto</span> <span class="n">searchOut</span> <span class="o">=</span> <span class="n">brkga</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="mf">3.0</span><span class="p">);</span> <span class="c1">// 3.0 seconds max</span>
<span class="linenos">125</span>   <span class="n">ESolutionTSP</span> <span class="n">best</span> <span class="o">=</span> <span class="o">*</span><span class="n">searchOut</span><span class="p">.</span><span class="n">best</span><span class="p">;</span>
<span class="linenos">126</span>   <span class="c1">// best solution value</span>
<span class="linenos">127</span>   <span class="n">best</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<span class="linenos">128</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;solution: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">best</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">129</span>
<span class="linenos">130</span>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;FINISHED&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">131</span>   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">132</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="more-examples">
<h2>More Examples<a class="headerlink" href="#more-examples" title="Permalink to this headline"></a></h2>
<p>For a other examples, see folder Examples/FCore-BRKGA and execute <code class="code docutils literal notranslate"><span class="pre">bazel</span> <span class="pre">build</span> <span class="pre">...</span></code></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Feel free to check folder <code class="code docutils literal notranslate"><span class="pre">OptFrame/Examples</span></code> for other examples on FCore and OptFrame Classic.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quick start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="concepts.html" class="btn btn-neutral float-right" title="Concepts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2007-2021, OptFrame Core Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>